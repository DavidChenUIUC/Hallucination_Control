Train dataset size: 14732
Test dataset size: 819
Max source length: 255
Max target length: 50
Keys of tokenized dataset: ['input_ids', 'attention_mask', 'labels']
Saving the dataset (1/1 shards): 100%|█████████████████████████████████████████████████| 14732/14732 [00:00<00:00, 509494.60 examples/s]
Saving the dataset (1/1 shards): 100%|█████████████████████████████████████████████████████| 819/819 [00:00<00:00, 239215.53 examples/s]




Loading checkpoint shards:  92%|██████████████████████████████████████████████████████████████████      | 11/12 [00:09<00:00,  1.09it/s]
trainable params: 18,874,368 || all params: 11,154,206,720 || trainable%: 0.16921300163961817
{'output_dir': 'lora-flan-t5-xxl', 'overwrite_output_dir': False, 'do_train': False, 'do_eval': False, 'do_predict': False, 'evaluation_strategy': 'no', 'prediction_loss_only': False, 'per_device_train_batch_size': 64, 'per_device_eval_batch_size': 8, 'per_gpu_train_batch_size': None, 'per_gpu_eval_batch_size': None, 'gradient_accumulation_steps': 1, 'eval_accumulation_steps': None, 'eval_delay': 0, 'learning_rate': 0.001, 'weight_decay': 0.0, 'adam_beta1': 0.9, 'adam_beta2': 0.999, 'adam_epsilon': 1e-08, 'max_grad_norm': 1.0, 'num_train_epochs': 5, 'max_steps': -1, 'lr_scheduler_type': 'linear', 'lr_scheduler_kwargs': {}, 'warmup_ratio': 0.0, 'warmup_steps': 0, 'log_level': 'passive', 'log_level_replica': 'warning', 'log_on_each_node': True, 'logging_dir': 'lora-flan-t5-xxl/logs', 'logging_strategy': 'steps', 'logging_first_step': False, 'logging_steps': 5, 'logging_nan_inf_filter': True, 'save_strategy': 'steps', 'save_steps': 500, 'save_total_limit': None, 'save_safetensors': True, 'save_on_each_node': False, 'save_only_model': False, 'no_cuda': False, 'use_cpu': False, 'use_mps_device': False, 'seed': 42, 'data_seed': None, 'jit_mode_eval': False, 'use_ipex': False, 'bf16': False, 'fp16': False, 'fp16_opt_level': 'O1', 'half_precision_backend': 'auto', 'bf16_full_eval': False, 'fp16_full_eval': False, 'tf32': None, 'local_rank': 0, 'ddp_backend': None, 'tpu_num_cores': None, 'tpu_metrics_debug': False, 'debug': [], 'dataloader_drop_last': False, 'eval_steps': None, 'dataloader_num_workers': 0, 'past_index': -1, 'run_name': 'lora-flan-t5-xxl', 'disable_tqdm': False, 'remove_unused_columns': True, 'label_names': None, 'load_best_model_at_end': False, 'metric_for_best_model': None, 'greater_is_better': None, 'ignore_data_skip': False, 'fsdp': [], 'fsdp_min_num_params': 0, 'fsdp_config': {'min_num_params': 0, 'xla': False, 'xla_fsdp_grad_ckpt': False}, 'fsdp_transformer_layer_cls_to_wrap': None, 'deepspeed': None, 'label_smoothing_factor': 0.0, 'optim': 'adamw_torch', 'optim_args': None, 'adafactor': False, 'group_by_length': False, 'length_column_name': 'length', 'report_to': ['wandb'], 'ddp_find_unused_parameters': None, 'ddp_bucket_cap_mb': None, 'ddp_broadcast_buffers': None, 'dataloader_pin_memory': True, 'dataloader_persistent_workers': False, 'skip_memory_metrics': True, 'use_legacy_prediction_loop': False, 'push_to_hub': False, 'resume_from_checkpoint': None, 'hub_model_id': None, 'hub_strategy': 'every_save', 'hub_token': '<HUB_TOKEN>', 'hub_private_repo': False, 'hub_always_push': False, 'gradient_checkpointing': False, 'gradient_checkpointing_kwargs': None, 'include_inputs_for_metrics': False, 'fp16_backend': 'auto', 'push_to_hub_model_id': None, 'push_to_hub_organization': None, 'push_to_hub_token': '<PUSH_TO_HUB_TOKEN>', 'mp_parameters': '', 'auto_find_batch_size': True, 'full_determinism': False, 'torchdynamo': None, 'ray_scope': 'last', 'ddp_timeout': 1800, 'torch_compile': False, 'torch_compile_backend': None, 'torch_compile_mode': None, 'dispatch_batches': None, 'split_batches': False, 'include_tokens_per_second': False, 'include_num_input_tokens_seen': False, 'neftune_noise_alpha': None, 'sortish_sampler': False, 'predict_with_generate': False, 'generation_max_length': None, 'generation_num_beams': None, 'generation_config': None}
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 12/12 [00:09<00:00,  1.23it/s]
/home/cwtang/.local/lib/python3.10/site-packages/peft/utils/other.py:143: FutureWarning: prepare_model_for_int8_training is deprecated and will be removed in a future version. Use prepare_model_for_kbit_training instead.
  warnings.warn(
  0%|                                                                                                          | 0/1155 [00:00<?, ?it/s]You're using a T5TokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
/home/cwtang/.local/lib/python3.10/site-packages/bitsandbytes/autograd/_functions.py:322: UserWarning: MatMul8bitLt: inputs will be cast from torch.float32 to float16 during quantization
  warnings.warn(f"MatMul8bitLt: inputs will be cast from {A.dtype} to float16 during quantization")


  0%|▏                                                                                              | 3/1155 [01:40<10:45:24, 33.61s/it]
  0%|                                                                                                          | 0/2305 [00:00<?, ?it/s]




  0%|▎                                                                                                                                  | 5/2305 [01:09<8:54:13, 13.94s/it]




  0%|▌                                                                                                                                  | 9/2305 [02:05<8:52:52, 13.93s/it]






  1%|▊                                                                                                                                 | 15/2305 [03:29<8:51:53, 13.94s/it]





  1%|█▏                                                                                                                                | 20/2305 [04:38<8:49:50, 13.91s/it]





  1%|█▍                                                                                                                                | 25/2305 [05:48<8:48:59, 13.92s/it]





  1%|█▋                                                                                                                                | 30/2305 [06:58<8:49:29, 13.96s/it]




  1%|█▉                                                                                                                                | 34/2305 [07:54<8:47:57, 13.95s/it]






  2%|██▎                                                                                                                               | 40/2305 [09:17<8:45:11, 13.91s/it]





  2%|██▌                                                                                                                               | 45/2305 [10:27<8:44:20, 13.92s/it]





  2%|██▊                                                                                                                               | 50/2305 [11:36<8:43:21, 13.93s/it]





  2%|███                                                                                                                               | 55/2305 [12:46<8:42:18, 13.93s/it]




  3%|███▎                                                                                                                              | 59/2305 [13:42<8:40:56, 13.92s/it]






  3%|███▋                                                                                                                              | 65/2305 [15:05<8:40:46, 13.95s/it]





  3%|███▉                                                                                                                              | 70/2305 [16:15<8:39:02, 13.93s/it]





  3%|████▏                                                                                                                             | 75/2305 [17:25<8:37:28, 13.92s/it]





  3%|████▌                                                                                                                             | 80/2305 [18:34<8:37:04, 13.94s/it]




  4%|████▋                                                                                                                             | 84/2305 [19:30<8:35:17, 13.92s/it]






  4%|█████                                                                                                                             | 90/2305 [20:54<8:34:02, 13.92s/it]





  4%|█████▎                                                                                                                            | 95/2305 [22:03<8:34:11, 13.96s/it]





  4%|█████▌                                                                                                                           | 100/2305 [23:13<8:32:24, 13.94s/it]





  5%|█████▉                                                                                                                           | 105/2305 [24:23<8:30:43, 13.93s/it]




  5%|██████                                                                                                                           | 109/2305 [25:18<8:30:03, 13.94s/it]






  5%|██████▍                                                                                                                          | 115/2305 [26:42<8:28:49, 13.94s/it]





  5%|██████▋                                                                                                                          | 120/2305 [27:52<8:27:30, 13.94s/it]





  5%|██████▉                                                                                                                          | 125/2305 [29:01<8:26:10, 13.93s/it]





  6%|███████▎                                                                                                                         | 130/2305 [30:11<8:25:05, 13.93s/it]




  6%|███████▍                                                                                                                         | 134/2305 [31:07<8:23:50, 13.92s/it]






  6%|███████▊                                                                                                                         | 140/2305 [32:30<8:22:39, 13.93s/it]





  6%|████████                                                                                                                         | 145/2305 [33:40<8:22:06, 13.95s/it]





  7%|████████▍                                                                                                                        | 150/2305 [34:50<8:20:07, 13.92s/it]





  7%|████████▋                                                                                                                        | 155/2305 [35:59<8:19:26, 13.94s/it]




  7%|████████▉                                                                                                                        | 159/2305 [36:55<8:18:11, 13.93s/it]






  7%|█████████▏                                                                                                                       | 165/2305 [38:19<8:16:43, 13.93s/it]





  7%|█████████▌                                                                                                                       | 170/2305 [39:28<8:15:46, 13.93s/it]





  8%|█████████▊                                                                                                                       | 175/2305 [40:38<8:14:51, 13.94s/it]





  8%|██████████                                                                                                                       | 180/2305 [41:48<8:13:27, 13.93s/it]





  8%|██████████▎                                                                                                                      | 185/2305 [42:57<8:11:47, 13.92s/it]





  8%|██████████▋                                                                                                                      | 190/2305 [44:07<8:10:48, 13.92s/it]





  8%|██████████▉                                                                                                                      | 195/2305 [45:17<8:10:33, 13.95s/it]





  9%|███████████▏                                                                                                                     | 200/2305 [46:27<8:08:53, 13.93s/it]




  9%|███████████▍                                                                                                                     | 204/2305 [47:22<8:07:27, 13.92s/it]






  9%|███████████▊                                                                                                                     | 210/2305 [48:46<8:05:59, 13.92s/it]





  9%|████████████                                                                                                                     | 215/2305 [49:55<8:04:11, 13.90s/it]





 10%|████████████▎                                                                                                                    | 220/2305 [51:05<8:03:03, 13.90s/it]




 10%|████████████▌                                                                                                                    | 224/2305 [52:00<8:01:46, 13.89s/it]






 10%|████████████▊                                                                                                                    | 230/2305 [53:24<8:00:19, 13.89s/it]





 10%|█████████████▏                                                                                                                   | 235/2305 [54:33<7:59:31, 13.90s/it]





 10%|█████████████▍                                                                                                                   | 240/2305 [55:43<7:58:41, 13.91s/it]





 11%|█████████████▋                                                                                                                   | 245/2305 [56:52<7:58:01, 13.92s/it]





 11%|█████████████▉                                                                                                                   | 250/2305 [58:02<7:56:33, 13.91s/it]





 11%|██████████████▎                                                                                                                  | 255/2305 [59:12<7:55:33, 13.92s/it]





 11%|██████████████▎                                                                                                                | 260/2305 [1:00:21<7:54:44, 13.93s/it]




 11%|██████████████▌                                                                                                                | 264/2305 [1:01:17<7:53:22, 13.92s/it]






 12%|██████████████▉                                                                                                                | 270/2305 [1:02:40<7:51:21, 13.90s/it]





 12%|███████████████▏                                                                                                               | 275/2305 [1:03:50<7:50:42, 13.91s/it]




 12%|███████████████▎                                                                                                               | 279/2305 [1:04:45<7:49:52, 13.92s/it]






 12%|███████████████▋                                                                                                               | 285/2305 [1:06:09<7:48:35, 13.92s/it]





 13%|███████████████▉                                                                                                               | 290/2305 [1:07:18<7:47:06, 13.91s/it]




 13%|████████████████▏                                                                                                              | 294/2305 [1:08:14<7:46:00, 13.90s/it]





 13%|████████████████▍                                                                                                              | 299/2305 [1:09:24<7:45:08, 13.91s/it]






 13%|████████████████▊                                                                                                              | 305/2305 [1:10:47<7:43:17, 13.90s/it]





 13%|█████████████████                                                                                                              | 310/2305 [1:11:57<7:42:26, 13.91s/it]




 14%|█████████████████▎                                                                                                             | 314/2305 [1:12:52<7:41:57, 13.92s/it]





 14%|█████████████████▌                                                                                                             | 319/2305 [1:14:02<7:40:15, 13.90s/it]






 14%|█████████████████▉                                                                                                             | 325/2305 [1:15:25<7:39:20, 13.92s/it]





 14%|██████████████████▏                                                                                                            | 330/2305 [1:16:35<7:37:07, 13.89s/it]




 14%|██████████████████▍                                                                                                            | 334/2305 [1:17:30<7:37:13, 13.92s/it]





 15%|██████████████████▋                                                                                                            | 339/2305 [1:18:40<7:35:56, 13.91s/it]






 15%|███████████████████                                                                                                            | 345/2305 [1:20:03<7:33:02, 13.87s/it]




 15%|███████████████████▏                                                                                                           | 349/2305 [1:20:59<7:32:41, 13.89s/it]





 15%|███████████████████▌                                                                                                           | 354/2305 [1:22:08<7:32:08, 13.90s/it]






 16%|███████████████████▊                                                                                                           | 360/2305 [1:23:32<7:30:17, 13.89s/it]





 16%|████████████████████                                                                                                           | 365/2305 [1:24:41<7:29:08, 13.89s/it]




 16%|████████████████████▎                                                                                                          | 369/2305 [1:25:37<7:28:11, 13.89s/it]






 16%|████████████████████▋                                                                                                          | 375/2305 [1:27:00<7:27:15, 13.90s/it]





 16%|████████████████████▉                                                                                                          | 380/2305 [1:28:09<7:25:41, 13.89s/it]




 17%|█████████████████████▏                                                                                                         | 384/2305 [1:29:05<7:25:43, 13.92s/it]





 17%|█████████████████████▍                                                                                                         | 389/2305 [1:30:15<7:24:32, 13.92s/it]






 17%|█████████████████████▊                                                                                                         | 395/2305 [1:31:38<7:22:49, 13.91s/it]





 17%|██████████████████████                                                                                                         | 400/2305 [1:32:48<7:21:11, 13.90s/it]




 18%|██████████████████████▎                                                                                                        | 404/2305 [1:33:43<7:20:05, 13.89s/it]






 18%|██████████████████████▌                                                                                                        | 410/2305 [1:35:07<7:18:58, 13.90s/it]





 18%|██████████████████████▊                                                                                                        | 415/2305 [1:36:16<7:17:54, 13.90s/it]




 18%|███████████████████████                                                                                                        | 419/2305 [1:37:12<7:17:06, 13.91s/it]






 18%|███████████████████████▍                                                                                                       | 425/2305 [1:38:35<7:15:04, 13.89s/it]





 19%|███████████████████████▋                                                                                                       | 430/2305 [1:39:44<7:13:39, 13.88s/it]




 19%|███████████████████████▉                                                                                                       | 434/2305 [1:40:40<7:13:24, 13.90s/it]





 19%|████████████████████████▏                                                                                                      | 439/2305 [1:41:50<7:12:14, 13.90s/it]






 19%|████████████████████████▌                                                                                                      | 445/2305 [1:43:13<7:11:06, 13.91s/it]




 19%|████████████████████████▋                                                                                                      | 449/2305 [1:44:08<7:09:17, 13.88s/it]






 20%|█████████████████████████                                                                                                      | 455/2305 [1:45:32<7:07:05, 13.85s/it]





 20%|█████████████████████████▎                                                                                                     | 460/2305 [1:46:41<7:06:24, 13.87s/it]




 20%|█████████████████████████▌                                                                                                     | 464/2305 [1:47:28<6:38:49, 13.00s/it]






 20%|█████████████████████████▉                                                                                                     | 470/2305 [1:48:51<7:01:08, 13.77s/it]





 21%|██████████████████████████▏                                                                                                    | 475/2305 [1:50:01<7:03:05, 13.87s/it]




 21%|██████████████████████████▍                                                                                                    | 479/2305 [1:50:56<7:02:00, 13.87s/it]






 21%|██████████████████████████▋                                                                                                    | 485/2305 [1:52:19<7:00:49, 13.87s/it]




 21%|██████████████████████████▉                                                                                                    | 489/2305 [1:53:15<6:59:36, 13.86s/it]






 21%|███████████████████████████▎                                                                                                   | 495/2305 [1:54:38<6:58:50, 13.88s/it]





  warnings.warn(f"MatMul8bitLt: inputs will be cast from {A.dtype} to float16 during quantization")500/2305 [1:55:48<6:57:53, 13.89s/it]
{'loss': 1.0069, 'learning_rate': 0.0007830802603036876, 'epoch': 1.08}




 22%|████████████████████▏                                                                       | 505/2305 [1:56:57<6:57:31, 13.92s/it]




 22%|████████████████████▎                                                                       | 509/2305 [1:57:53<6:55:27, 13.88s/it]






 22%|████████████████████▌                                                                       | 515/2305 [1:59:16<6:53:25, 13.86s/it]





 23%|████████████████████▊                                                                       | 520/2305 [2:00:25<6:52:42, 13.87s/it]




 23%|████████████████████▉                                                                       | 524/2305 [2:01:21<6:52:08, 13.88s/it]






 23%|█████████████████████▏                                                                      | 530/2305 [2:02:44<6:50:17, 13.87s/it]





 23%|█████████████████████▎                                                                      | 535/2305 [2:03:54<6:49:24, 13.88s/it]




 23%|█████████████████████▌                                                                      | 539/2305 [2:04:49<6:48:07, 13.87s/it]






 24%|█████████████████████▊                                                                      | 545/2305 [2:06:12<6:46:56, 13.87s/it]




 24%|█████████████████████▉                                                                      | 549/2305 [2:07:08<6:46:00, 13.87s/it]






 24%|██████████████████████▏                                                                     | 555/2305 [2:08:31<6:44:56, 13.88s/it]





 24%|██████████████████████▎                                                                     | 560/2305 [2:09:40<6:43:20, 13.87s/it]





 25%|██████████████████████▌                                                                     | 565/2305 [2:10:50<6:42:19, 13.87s/it]





 25%|██████████████████████▊                                                                     | 570/2305 [2:11:59<6:41:24, 13.88s/it]





 25%|██████████████████████▉                                                                     | 575/2305 [2:13:09<6:40:24, 13.89s/it]





 25%|███████████████████████▏                                                                    | 580/2305 [2:14:18<6:39:01, 13.88s/it]





 25%|███████████████████████▎                                                                    | 585/2305 [2:15:27<6:37:39, 13.87s/it]





 26%|███████████████████████▌                                                                    | 590/2305 [2:16:37<6:36:25, 13.87s/it]





 26%|███████████████████████▋                                                                    | 595/2305 [2:17:46<6:35:14, 13.87s/it]





 26%|███████████████████████▉                                                                    | 600/2305 [2:18:55<6:33:35, 13.85s/it]





 26%|████████████████████████▏                                                                   | 605/2305 [2:20:05<6:32:31, 13.85s/it]




 26%|████████████████████████▎                                                                   | 609/2305 [2:21:00<6:32:21, 13.88s/it]






 27%|████████████████████████▌                                                                   | 615/2305 [2:22:23<6:30:43, 13.87s/it]





 27%|████████████████████████▋                                                                   | 620/2305 [2:23:33<6:29:21, 13.86s/it]





 27%|████████████████████████▉                                                                   | 625/2305 [2:24:42<6:27:39, 13.84s/it]





 27%|█████████████████████████▏                                                                  | 630/2305 [2:25:51<6:27:20, 13.88s/it]





 28%|█████████████████████████▎                                                                  | 635/2305 [2:27:01<6:26:03, 13.87s/it]





 28%|█████████████████████████▌                                                                  | 640/2305 [2:28:10<6:24:45, 13.86s/it]





 28%|█████████████████████████▋                                                                  | 645/2305 [2:29:19<6:24:12, 13.89s/it]





 28%|█████████████████████████▉                                                                  | 650/2305 [2:30:29<6:23:03, 13.89s/it]





 28%|██████████████████████████▏                                                                 | 655/2305 [2:31:38<6:22:03, 13.89s/it]





 29%|████████████████████████████████████▎                                                                                          | 660/2305 [2:32:48<6:20:40, 13.88s/it]



  File "/home/cwtang/david_dynamo/flan_t5.py", line 160, in <module>                                                                | 663/2305 [2:33:29<6:20:11, 13.89s/it]
    predictions, labels = eval_pred
  File "/home/cwtang/.local/lib/python3.10/site-packages/transformers/trainer.py", line 1537, in train
    return inner_training_loop(
  File "/home/cwtang/.local/lib/python3.10/site-packages/accelerate/utils/memory.py", line 136, in decorator
    return function(batch_size, *args, **kwargs)
  File "/home/cwtang/.local/lib/python3.10/site-packages/transformers/trainer.py", line 1854, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs)
  File "/home/cwtang/.local/lib/python3.10/site-packages/transformers/trainer.py", line 2744, in training_step
    self.accelerator.backward(loss)
  File "/home/cwtang/.local/lib/python3.10/site-packages/accelerate/accelerator.py", line 1905, in backward
    loss.backward(**kwargs)
  File "/usr/local/lib/python3.10/dist-packages/torch/_tensor.py", line 487, in backward
    torch.autograd.backward(
  File "/usr/local/lib/python3.10/dist-packages/torch/autograd/__init__.py", line 200, in backward
    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
KeyboardInterrupt